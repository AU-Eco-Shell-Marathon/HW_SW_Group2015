\newpage
\section{Signal Converter}
The primary purpose of this block is to convert the output from the Torque Sensor to a signal which can be correctly measured by the Control Unit.

\subsection{Design}
The torque-signal and the velocity-signal from the Torque Sensor are measured by the PSoC using different techniques and the Signal Converter must therefore be in charge of two different signal-processing techniques: Rescaling the torque-signal and reducing the noise in the velocity-signal.

\input{Hardware/SignalConverter/Torque}
\input{Hardware/SignalConverter/Velocity}

\newpage
\subsection{Implementation}
The designs from the previous section is implemented using a non-inverting adder and two schmitt-triggers in series.

\textbf{Non-inverting adder}\\
The circuit is built using a MCP6004 I/P operational amplifier\cite{MCP6004}. Its positive and negative supply lines are connected with 5 VDC and ground. The op-amps positive power supply is connected in parallel with a $\SI{100}{\nano \farad}$ capacitor. This capacitor improves the op-amps high-frequency response. The final design is seen on Figure \vref{fig:SignalConverterTorque3}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\linewidth]{Hardware/SignalConverter/TorqueDesign3}
	\caption{Implemented circuit design on Rolling Road}
	\label{fig:SignalConverterTorque3}
\end{figure}

\textbf{Schmitt-trigger}\\
The noise reduction is implemented using two 74HC14 hex inverter with Schmitt-trigger inputs\cite{74HC14}. The inverter creates a small propagation delay between the Torque Sensor's output and the PSoC's input. At a 5 VDC power supply this delay is given by:
\begin{equation}
	t_{pd} = t_{PHL} = t_{PLH} = \SI{24}{\nano \second}
\end{equation}
Which means that if the ADC in the PSoC samples input signals with a frequency greater than $\SI{41.67}{\mega \hertz}$ then the resulting samples are gonna be displaced one sample compared to the velocity-samples.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\linewidth]{Hardware/Pictures/74HC14_waveform}
	\caption{Typical inverter-waveform}
	\label{fig:SchmittTrigger_waveform}
\end{figure}

In order to counter the inverting property of 74HC14, and create a comperator, the noise reduction  must consist of two Schmitt-triggers in series. This gives the subsystem a total propagation delay of $\SI{24}{\nano \second}$. As the 74HC14 contains six Schmitt-triggers the 4 unused Schmitt-trigger's inputs are connected to ground in order to prevent unwanted oscilliation. The subsystem's final design is seen on Figure \ref{fig:SignalConverterVelocity} below.

\begin{figure}[H]
	\centering
	\includegraphics[width=0.5\linewidth]{Hardware/SignalConverter/VelocityDesign}
	\caption{Implemented circuit design on Rolling Road}
	\label{fig:SignalConverterVelocity}
\end{figure}

\subsection{Unit test}
The Signal Converter's unit test is split into two: The torque- and the velocity-signal:

\textbf{Torque-signal}\\
The non-inverting adder is tested using Analog Discovery's built-in oscilloscope and voltage-source. The input-voltage is generated using the voltage-source and lies within \SI{-5}{\volt} and \SI{+5}{\volt}. The output-signal is then measured to check if it is rescaled correctly to lie between \SI{0}{\volt} and \SI{+5}{\volt}. The different outputs can be seen on the figures on the next pages. The results from the test are listed below:
\begin{equation}
	\begin{split}
		V_{in} = -\SI{5}{\volt} \quad &\Rightarrow \quad V_{out} = \SI{-0.020}{\volt}\\
		V_{in} = \SI{0}{\volt} \quad &\Rightarrow \quad V_{out} = \SI{2.476}{\volt}\\
		V_{in} = +\SI{5}{\volt} \quad &\Rightarrow \quad V_{out} = \SI{4.946}{\volt}\\
	\end{split}
\end{equation}
It is seen that there is a small measurement-error. This error can be corrected in the PSoC - as long as the output-voltage is positive.

\fxnote{Ville ikke mene det er nødvendigt med graf, da de ikke giver noget information. Kunne ellers have været rart at både input og output blev målt og vist - JH}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{Hardware/SignalConverter/Torque_test1}
	\caption{Non-inverting adders output with an input of -5 Volt}
	\label{fig:TorqueTest1}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{Hardware/SignalConverter/Torque_test2}
	\caption{Non-inverting adders output with an input of 0 Volt}
	\label{fig:TorqueTest2}
\end{figure}

\begin{figure}[H]
	\centering
	\includegraphics[width=0.9\linewidth]{Hardware/SignalConverter/Torque_test3}
	\caption{Non-inverting adders output with an input of +5 Volt}
	\label{fig:TorqueTest3}
\end{figure}

\textbf{Velocity-signal}\\
This part of the Signal Converter hasn't had a unity test since this was done in the Previous System\cite{BAC_rullefelt}. For a complete unity test of the sensor, the reader is referred to the related documentation on page 49 to 51.